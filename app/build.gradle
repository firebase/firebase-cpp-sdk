// Copyright 2018 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

buildscript {
  repositories {
    google()
    jcenter()
  }
  dependencies {
    classpath 'com.android.tools.build:gradle:3.3.3'
  }
}
allprojects {
  repositories {
    google()
    jcenter()
  }
}

apply plugin: 'com.android.library'

ext {
  firebaseAndroidStl = System.getenv('FIREBASE_ANDROID_STL')
  firebaseAndroidStl = firebaseAndroidStl != null ? firebaseAndroidStl : ''
}

android {
  compileSdkVersion 28
  buildToolsVersion '28.0.3'

  sourceSets {
    main {
      manifest.srcFile '../android_build_files/AndroidManifest.xml'
    }
  }

  externalNativeBuild {
    cmake {
      path '../CMakeLists.txt'
    }
  }

  defaultConfig {
    minSdkVersion 19
    targetSdkVersion 28
    versionCode 1
    versionName "1.0"

    buildTypes {
      release {
        minifyEnabled false
      }
    }

    externalNativeBuild {
      cmake {
        targets 'firebase_app'
        // Don't configure all the cmake subprojects.
        arguments '-DFIREBASE_INCLUDE_LIBRARY_DEFAULT=OFF',
		  "-DFIREBASE_ANDROID_STL=${firebaseAndroidStl}"
      }
    }
  }

  lintOptions {
    abortOnError false
  }
}

apply from: "$rootDir/android_build_files/android_abis.gradle"
apply from: "$rootDir/android_build_files/extract_and_dex.gradle"
apply from: "$rootDir/android_build_files/generate_proguard.gradle"
project.afterEvaluate {
  generateProguardFile('app')
  setupDexDependencies(':app:app_resources')
  setupDexDependencies(':app:google_api_resources')
  setupDexDependencies(':app:invites_resources')
}
